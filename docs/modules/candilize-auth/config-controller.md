# ConfigController — Trading Pairs, Intervals & Exchanges

**File**: `candilize-auth/src/main/java/com/mohsindev/candilize/auth/api/controller/ConfigController.java`

## What This File Does

This controller manages the **trading configuration** — which cryptocurrency pairs (BTCUSDT, ETHUSDT) and candle intervals (1m, 5m, 1h) the system supports. All endpoints require `ROLE_ADMIN`.

---

## Full Source with Commentary

```java
@RestController
@RequestMapping("/api/v1/config")
@RequiredArgsConstructor
@PreAuthorize("hasRole('ADMIN')")                             // 1
public class ConfigController {

    private final ConfigService configService;                // 2

    @GetMapping("/pairs")                                     // 3
    public ResponseEntity<List<PairResponse>> listPairs() {
        return ResponseEntity.ok(configService.getAllPairs());
    }

    @PostMapping("/pairs")                                    // 4
    public ResponseEntity<PairResponse> addPair(
            @Valid @RequestBody PairRequest request) {
        PairResponse response = configService.addPair(request);
        return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }

    @PutMapping("/pairs/{id}")                                // 5
    public ResponseEntity<PairResponse> updatePair(
            @PathVariable Long id,                            // 6
            @RequestBody Map<String, Boolean> body) {
        Boolean enabled = body != null ? body.get("enabled") : null;
        PairResponse response = configService.updatePair(id, enabled);
        return ResponseEntity.ok(response);
    }

    @DeleteMapping("/pairs/{id}")                             // 7
    public ResponseEntity<Void> deletePair(@PathVariable Long id) {
        configService.deletePair(id);
        return ResponseEntity.noContent().build();            // 8
    }

    @GetMapping("/intervals")                                 // 9
    public ResponseEntity<List<IntervalResponse>> listIntervals() {
        return ResponseEntity.ok(configService.getAllIntervals());
    }

    @PutMapping("/intervals/{id}")
    public ResponseEntity<IntervalResponse> updateInterval(
            @PathVariable Long id,
            @RequestBody Map<String, Boolean> body) {
        Boolean enabled = body != null ? body.get("enabled") : null;
        IntervalResponse response = configService.updateInterval(id, enabled);
        return ResponseEntity.ok(response);
    }

    @GetMapping("/exchanges")                                 // 10
    public ResponseEntity<List<String>> listExchanges() {
        return ResponseEntity.ok(configService.getAvailableExchanges());
    }
}
```

### Line-by-Line

**Line 1**: `@PreAuthorize("hasRole('ADMIN')")` — class-level authorization. Every method in this controller requires the authenticated user to have `ROLE_ADMIN`. This is a **method-level security** annotation enabled by `@EnableMethodSecurity` in `SecurityConfig`. Spring evaluates this before the method runs — if the user doesn't have the role, it throws `AccessDeniedException` (HTTP 403).

**Line 2**: `ConfigService` is injected via constructor injection (generated by `@RequiredArgsConstructor`).

**Line 3**: `@GetMapping("/pairs")` — maps to `GET /api/v1/config/pairs`. Returns all supported trading pairs from the database (via Redis cache).

**Line 4**: `@PostMapping("/pairs")` — adds a new pair. `@Valid` triggers validation on `PairRequest` (symbol, baseAsset, quoteAsset are all required). Returns HTTP 201 Created.

**Line 5**: `@PutMapping("/pairs/{id}")` — updates a pair by its database ID.

**Line 6**: `@PathVariable Long id` — extracts the `{id}` from the URL path. If the URL is `/api/v1/config/pairs/3`, then `id` is `3`. Spring automatically converts the string `"3"` to `Long`.

**Line 7**: `@DeleteMapping("/pairs/{id}")` — deletes a pair.

**Line 8**: `ResponseEntity.noContent().build()` — returns HTTP 204 No Content (success, no body). Standard response for DELETE operations.

**Line 10**: `@GetMapping("/exchanges")` — returns `["mexc", "binance"]` — the list of supported exchange APIs.

---

## Response DTOs

### PairResponse
```java
public record PairResponse(Long id, String symbol, String baseAsset,
                           String quoteAsset, Boolean enabled) {}
```
Example JSON:
```json
{"id": 1, "symbol": "BTCUSDT", "baseAsset": "BTC", "quoteAsset": "USDT", "enabled": true}
```

### IntervalResponse
```java
public record IntervalResponse(Long id, String intervalCode,
                                String description, Boolean enabled) {}
```
Example JSON:
```json
{"id": 1, "intervalCode": "1h", "description": "1 hour", "enabled": true}
```

---

## Testing with cURL

```bash
# First, get a JWT token (must be admin user)
TOKEN=$(curl -s -X POST http://localhost:8081/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' | jq -r '.accessToken')

# List all pairs
curl http://localhost:8081/api/v1/config/pairs \
  -H "Authorization: Bearer $TOKEN"

# Add a new pair
curl -X POST http://localhost:8081/api/v1/config/pairs \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"symbol":"DOTUSDT","baseAsset":"DOT","quoteAsset":"USDT"}'

# Disable a pair (id=1)
curl -X PUT http://localhost:8081/api/v1/config/pairs/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"enabled":false}'

# Delete a pair (id=6)
curl -X DELETE http://localhost:8081/api/v1/config/pairs/6 \
  -H "Authorization: Bearer $TOKEN"

# List intervals
curl http://localhost:8081/api/v1/config/intervals \
  -H "Authorization: Bearer $TOKEN"

# List exchanges
curl http://localhost:8081/api/v1/config/exchanges \
  -H "Authorization: Bearer $TOKEN"
```
